define("block_azure_openai_chat/chatlib",["exports"],(function(_exports){var questionString,errorString,userName,assistantName;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(Y,sourceOfTruth,user,assistant)=>{document.querySelector("#azure_openai_input").addEventListener("keyup",(e=>{13===e.which&&""!==e.target.value&&(addToChatLog("user",e.target.value),createCompletion(e.target.value,sourceOfTruth),e.target.value="")})),userName=user,assistantName=assistant,require(["core/str"],(function(str){str.get_strings([{key:"askaquestion",component:"block_azure_openai_chat"},{key:"erroroccurred",component:"block_azure_openai_chat"}]).then((results=>{questionString=results[0],errorString=results[1]}))}))};const addToChatLog=(type,message)=>{let messageContainer=document.querySelector("#azure_openai_chat_log");messageContainer.insertAdjacentHTML("beforeend",`\n        <div class='azure_openai_message ${type}'>\n            ${message}\n        </div>\n    `),messageContainer.scrollTop=messageContainer.scrollHeight},createCompletion=(message,sourceOfTruth)=>{const history=buildTranscript();document.querySelector("#azure_openai_input").classList.add("disabled"),document.querySelector("#azure_openai_input").classList.remove("error"),document.querySelector("#azure_openai_input").placeholder=questionString,document.querySelector("#azure_openai_input").blur(),addToChatLog("bot loading","..."),fetch(`${M.cfg.wwwroot}/blocks/azure_openai_chat/api/completion.php`,{method:"POST",body:JSON.stringify({message:message,history:history,sourceOfTruth:sourceOfTruth})}).then((response=>{let messageContainer=document.querySelector("#azure_openai_chat_log");if(messageContainer.removeChild(messageContainer.lastElementChild),document.querySelector("#azure_openai_input").classList.remove("disabled"),response.ok)return response.json();throw Error(response.statusText)})).then((data=>{try{data.choices[0].text?addToChatLog("bot",data.choices[0].text):addToChatLog("bot",data.choices[0].message.content)}catch(error){addToChatLog("bot",data.error.message)}})).catch((()=>{document.querySelector("#azure_openai_input").classList.add("error"),document.querySelector("#azure_openai_input").placeholder=errorString}))},buildTranscript=()=>{let transcript=[];return document.querySelectorAll(".azure_openai_message").forEach(((message,index)=>{if(index===document.querySelectorAll(".azure_openai_message").length-1)return;let user=userName;message.classList.contains("bot")&&(user=assistantName),transcript.push({user:user,message:message.innerText})})),transcript}}));

//# sourceMappingURL=chatlib.min.js.map